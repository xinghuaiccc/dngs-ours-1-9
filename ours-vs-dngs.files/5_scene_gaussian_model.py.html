<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WinMerge File Compare Report</title>
<style>
<!--
table { table-layout: fixed; margin: 0; border: 1px solid #a0a0a0; box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.15); }
th { position: sticky; top: 0; }
td,th { word-break: break-all; font-size: 10pt; padding: 0 3px; }
tr { vertical-align: top; }
.title { font-weight: bold; color: white; background-color: blue; vertical-align: top; text-align: center; padding: 4px 4px; background: linear-gradient(mediumblue, darkblue);}
.sf3b2 {color: #000000; background-color: #ffffff; }
.sf3b5 {color: #000000; background-color: #0078d7; }
.sf3b14 {color: #000000; background-color: #ffa0a0; }
.sf3b16 {color: #000000; background-color: #f1e2ad; }
.sf3b18 {color: #000000; background-color: #ffaa82; }
.sf3b19 {color: #000000; background-color: #c8816c; }
.sf6b2 {color: #ffffff; background-color: #ffffff; }
.sf6b5 {color: #ffffff; background-color: #0078d7; }
.sf6b14 {color: #ffffff; background-color: #ffa0a0; }
.sf6b16 {color: #ffffff; background-color: #f1e2ad; }
.sf6b18 {color: #ffffff; background-color: #ffaa82; }
.sf6b19 {color: #ffffff; background-color: #c8816c; }
.sf7b2 {color: #0000ff; background-color: #ffffff; font-weight: bold; }
.sf7b5 {color: #0000ff; background-color: #0078d7; font-weight: bold; }
.sf7b14 {color: #0000ff; background-color: #ffa0a0; font-weight: bold; }
.sf7b16 {color: #0000ff; background-color: #f1e2ad; font-weight: bold; }
.sf7b18 {color: #0000ff; background-color: #ffaa82; font-weight: bold; }
.sf7b19 {color: #0000ff; background-color: #c8816c; font-weight: bold; }
.sf8b2 {color: #800080; background-color: #ffffff; }
.sf8b5 {color: #800080; background-color: #0078d7; }
.sf8b14 {color: #800080; background-color: #ffa0a0; }
.sf8b16 {color: #800080; background-color: #f1e2ad; }
.sf8b18 {color: #800080; background-color: #ffaa82; }
.sf8b19 {color: #800080; background-color: #c8816c; }
.sf9b2 {color: #008000; background-color: #ffffff; }
.sf9b5 {color: #008000; background-color: #0078d7; }
.sf9b14 {color: #008000; background-color: #ffa0a0; }
.sf9b16 {color: #008000; background-color: #f1e2ad; }
.sf9b18 {color: #008000; background-color: #ffaa82; }
.sf9b19 {color: #008000; background-color: #c8816c; }
.sf10b2 {color: #ff0000; background-color: #ffffff; }
.sf10b5 {color: #ff0000; background-color: #0078d7; }
.sf10b14 {color: #ff0000; background-color: #ffa0a0; }
.sf10b16 {color: #ff0000; background-color: #f1e2ad; }
.sf10b18 {color: #ff0000; background-color: #ffaa82; }
.sf10b19 {color: #ff0000; background-color: #c8816c; }
.sf11b2 {color: #606060; background-color: #ffffff; }
.sf11b5 {color: #606060; background-color: #0078d7; }
.sf11b14 {color: #606060; background-color: #ffa0a0; }
.sf11b16 {color: #606060; background-color: #f1e2ad; }
.sf11b18 {color: #606060; background-color: #ffaa82; }
.sf11b19 {color: #606060; background-color: #c8816c; }
.sf12b2 {color: #800000; background-color: #ffffff; }
.sf12b5 {color: #800000; background-color: #0078d7; }
.sf12b14 {color: #800000; background-color: #ffa0a0; }
.sf12b16 {color: #800000; background-color: #f1e2ad; }
.sf12b18 {color: #800000; background-color: #ffaa82; }
.sf12b19 {color: #800000; background-color: #c8816c; }
.sf13b2 {color: #0080c0; background-color: #ffffff; }
.sf13b5 {color: #0080c0; background-color: #0078d7; }
.sf13b14 {color: #0080c0; background-color: #ffa0a0; }
.sf13b16 {color: #0080c0; background-color: #f1e2ad; }
.sf13b18 {color: #0080c0; background-color: #ffaa82; }
.sf13b19 {color: #0080c0; background-color: #c8816c; }
.sf15b2 {color: #000000; background-color: #ffffff; }
.sf15b5 {color: #000000; background-color: #0078d7; }
.sf15b14 {color: #000000; background-color: #ffa0a0; }
.sf15b16 {color: #000000; background-color: #f1e2ad; }
.sf15b18 {color: #000000; background-color: #ffaa82; }
.sf15b19 {color: #000000; background-color: #c8816c; }
.sf17b2 {color: #000000; background-color: #ffffff; }
.sf17b5 {color: #000000; background-color: #0078d7; }
.sf17b14 {color: #000000; background-color: #ffa0a0; }
.sf17b16 {color: #000000; background-color: #f1e2ad; }
.sf17b18 {color: #000000; background-color: #ffaa82; }
.sf17b19 {color: #000000; background-color: #c8816c; }
.sf20b2 {color: #000080; background-color: #ffffff; }
.sf20b5 {color: #000080; background-color: #0078d7; }
.sf20b14 {color: #000080; background-color: #ffa0a0; }
.sf20b16 {color: #000080; background-color: #f1e2ad; }
.sf20b18 {color: #000080; background-color: #ffaa82; }
.sf20b19 {color: #000080; background-color: #c8816c; }
.sf21b2 {color: #0080c0; background-color: #ffffff; }
.sf21b5 {color: #0080c0; background-color: #0078d7; }
.sf21b14 {color: #0080c0; background-color: #ffa0a0; }
.sf21b16 {color: #0080c0; background-color: #f1e2ad; }
.sf21b18 {color: #0080c0; background-color: #ffaa82; }
.sf21b19 {color: #0080c0; background-color: #c8816c; }
.sf3b2i {color: #ababab; background-color: #ffffff; }
.sf3b5i {color: #005190; background-color: #0078d7; }
.sf3b14i {color: #ab6b6b; background-color: #ffa0a0; }
.sf3b16i {color: #a19774; background-color: #f1e2ad; }
.sf3b18i {color: #ab7257; background-color: #ffaa82; }
.sf3b19i {color: #865749; background-color: #c8816c; }
.sf6b2i {color: #ffffff; background-color: #ffffff; }
.sf6b5i {color: #54a4e4; background-color: #0078d7; }
.sf6b14i {color: #ffbfbf; background-color: #ffa0a0; }
.sf6b16i {color: #f5ebc8; background-color: #f1e2ad; }
.sf6b18i {color: #ffc6ab; background-color: #ffaa82; }
.sf6b19i {color: #daaa9c; background-color: #c8816c; }
.sf7b2i {color: #ababff; background-color: #ffffff; font-weight: bold; }
.sf7b5i {color: #0051e4; background-color: #0078d7; font-weight: bold; }
.sf7b14i {color: #ab6bbf; background-color: #ffa0a0; font-weight: bold; }
.sf7b16i {color: #a197c8; background-color: #f1e2ad; font-weight: bold; }
.sf7b18i {color: #ab72ab; background-color: #ffaa82; font-weight: bold; }
.sf7b19i {color: #86579c; background-color: #c8816c; font-weight: bold; }
.sf8b2i {color: #d5abd5; background-color: #ffffff; }
.sf8b5i {color: #2a51bb; background-color: #0078d7; }
.sf8b14i {color: #d56b96; background-color: #ffa0a0; }
.sf8b16i {color: #cc979f; background-color: #f1e2ad; }
.sf8b18i {color: #d57282; background-color: #ffaa82; }
.sf8b19i {color: #b15772; background-color: #c8816c; }
.sf9b2i {color: #abd5ab; background-color: #ffffff; }
.sf9b5i {color: #007a90; background-color: #0078d7; }
.sf9b14i {color: #ab966b; background-color: #ffa0a0; }
.sf9b16i {color: #a1c274; background-color: #f1e2ad; }
.sf9b18i {color: #ab9d57; background-color: #ffaa82; }
.sf9b19i {color: #868149; background-color: #c8816c; }
.sf10b2i {color: #ffabab; background-color: #ffffff; }
.sf10b5i {color: #545190; background-color: #0078d7; }
.sf10b14i {color: #ff6b6b; background-color: #ffa0a0; }
.sf10b16i {color: #f59774; background-color: #f1e2ad; }
.sf10b18i {color: #ff7257; background-color: #ffaa82; }
.sf10b19i {color: #da5749; background-color: #c8816c; }
.sf11b2i {color: #cbcbcb; background-color: #ffffff; }
.sf11b5i {color: #1f71b0; background-color: #0078d7; }
.sf11b14i {color: #cb8b8b; background-color: #ffa0a0; }
.sf11b16i {color: #c1b794; background-color: #f1e2ad; }
.sf11b18i {color: #cb9277; background-color: #ffaa82; }
.sf11b19i {color: #a67769; background-color: #c8816c; }
.sf12b2i {color: #d5abab; background-color: #ffffff; }
.sf12b5i {color: #2a5190; background-color: #0078d7; }
.sf12b14i {color: #d56b6b; background-color: #ffa0a0; }
.sf12b16i {color: #cc9774; background-color: #f1e2ad; }
.sf12b18i {color: #d57257; background-color: #ffaa82; }
.sf12b19i {color: #b15749; background-color: #c8816c; }
.sf13b2i {color: #abd5eb; background-color: #ffffff; }
.sf13b5i {color: #007ad0; background-color: #0078d7; }
.sf13b14i {color: #ab96aa; background-color: #ffa0a0; }
.sf13b16i {color: #a1c2b3; background-color: #f1e2ad; }
.sf13b18i {color: #ab9d96; background-color: #ffaa82; }
.sf13b19i {color: #868187; background-color: #c8816c; }
.sf15b2i {color: #ababab; background-color: #ffffff; }
.sf15b5i {color: #005190; background-color: #0078d7; }
.sf15b14i {color: #ab6b6b; background-color: #ffa0a0; }
.sf15b16i {color: #a19774; background-color: #f1e2ad; }
.sf15b18i {color: #ab7257; background-color: #ffaa82; }
.sf15b19i {color: #865749; background-color: #c8816c; }
.sf17b2i {color: #ababab; background-color: #ffffff; }
.sf17b5i {color: #005190; background-color: #0078d7; }
.sf17b14i {color: #ab6b6b; background-color: #ffa0a0; }
.sf17b16i {color: #a19774; background-color: #f1e2ad; }
.sf17b18i {color: #ab7257; background-color: #ffaa82; }
.sf17b19i {color: #865749; background-color: #c8816c; }
.sf20b2i {color: #ababd5; background-color: #ffffff; }
.sf20b5i {color: #0051bb; background-color: #0078d7; }
.sf20b14i {color: #ab6b96; background-color: #ffa0a0; }
.sf20b16i {color: #a1979f; background-color: #f1e2ad; }
.sf20b18i {color: #ab7282; background-color: #ffaa82; }
.sf20b19i {color: #865772; background-color: #c8816c; }
.sf21b2i {color: #abd5eb; background-color: #ffffff; }
.sf21b5i {color: #007ad0; background-color: #0078d7; }
.sf21b14i {color: #ab96aa; background-color: #ffa0a0; }
.sf21b16i {color: #a1c2b3; background-color: #f1e2ad; }
.sf21b18i {color: #ab9d96; background-color: #ffaa82; }
.sf21b19i {color: #868187; background-color: #c8816c; }
.cn {text-align: center; word-break: normal; color: #000000; background-color: #f0f0f0;}
.ln {text-align: right; word-break: normal; color: #000000; background-color: #f0f0f0;}
-->
</style>
</head>
<body>
<table style="width: 100%; border-collapse: collapse;">
<colgroup>
<col style="width: 0.5em;" />
<col style="width: calc(100% / 2 - 0.5em);" />
<col style="width: 0.5em;" />
<col style="width: calc(100% / 2 - 0.5em);" />
</colgroup>
<thead>
<tr>
<th colspan="2" class="title">\\wsl.localhost\Ubuntu-20.04-C\root\DNGaussian\scene\gaussian_model.py</th>
<th colspan="2" class="title">\\wsl.localhost\Ubuntu-20.04-C\root\ours-sprse\scene\gaussian_model.py</th>
</tr>
</thead>
<tbody>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># Copyright (C) 2023, Inria</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># Copyright (C) 2023, Inria</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># GRAPHDECO research group, https://team.inria.fr/graphdeco</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># GRAPHDECO research group, https://team.inria.fr/graphdeco</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># All rights reserved.</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># All rights reserved.</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># This software is free for non-commercial, research and evaluation use </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># This software is free for non-commercial, research and evaluation use </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># under the terms of the LICENSE.md file.</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># under the terms of the LICENSE.md file.</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># For inquiries contact &nbsp;george.drettakis@inria.fr</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2"># For inquiries contact &nbsp;george.drettakis@inria.fr</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf9b2">#</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">numpy</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">as</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">np</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">numpy</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">as</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">np</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">general_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">inverse_sigmoid</span><span class="sf11b2">, </span><span class="sf3b2">get_expon_lr_func</span><span class="sf11b2">, </span><span class="sf3b2">build_rotation</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">general_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">inverse_sigmoid</span><span class="sf11b2">, </span><span class="sf3b2">get_expon_lr_func</span><span class="sf11b2">, </span><span class="sf3b2">build_rotation</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">nn</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">nn</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">os</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">os</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">system_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">mkdir_p</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">system_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">mkdir_p</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">plyfile</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">PlyData</span><span class="sf11b2">, </span><span class="sf3b2">PlyElement</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">plyfile</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">PlyData</span><span class="sf11b2">, </span><span class="sf3b2">PlyElement</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">sh_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">RGB2SH</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">sh_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">RGB2SH</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">simple_knn</span><span class="sf11b2">.</span><span class="sf3b2">_C</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">distCUDA2</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">simple_knn</span><span class="sf11b2">.</span><span class="sf3b2">_C</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">distCUDA2</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">graphics_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">BasicPointCloud</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">graphics_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">BasicPointCloud</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">general_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">strip_symmetric</span><span class="sf11b2">, </span><span class="sf3b2">build_scaling_rotation</span><span class="sf11b2">, </span><span class="sf3b2">quaternion_to_matrix</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">utils</span><span class="sf11b2">.</span><span class="sf3b2">general_utils</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">strip_symmetric</span><span class="sf11b2">, </span><span class="sf3b2">build_scaling_rotation</span><span class="sf11b2">, </span><span class="sf3b2">quaternion_to_matrix</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">scene</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">GridRenderer</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">from</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">scene</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">import</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">GridRenderer</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">GaussianModel</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf7b2">class</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">GaussianModel</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">setup_functions</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">setup_functions</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">build_covariance_from_scaling_rotation</span><span class="sf11b2">(<wbr></span><span class="sf3b2">scaling</span><span class="sf11b2">, </span><span class="sf3b2">scaling_modifier</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">build_covariance_from_scaling_rotation</span><span class="sf11b2">(<wbr></span><span class="sf3b2">scaling</span><span class="sf11b2">, </span><span class="sf3b2">scaling_modifier</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">L</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">build_scaling_rotation</span><span class="sf11b2">(</span><span class="sf3b2">scaling_modifier<wbr></span><span class="sf11b2">&nbsp;* </span><span class="sf3b2">scaling</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">L</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">build_scaling_rotation</span><span class="sf11b2">(</span><span class="sf3b2">scaling_modifier<wbr></span><span class="sf11b2">&nbsp;* </span><span class="sf3b2">scaling</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">actual_covariance</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">L</span><span class="sf11b2">&nbsp;@ </span><span class="sf3b2">L</span><span class="sf11b2">.</span><span class="sf8b2">transpose</span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">2</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">actual_covariance</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">L</span><span class="sf11b2">&nbsp;@ </span><span class="sf3b2">L</span><span class="sf11b2">.</span><span class="sf8b2">transpose</span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">2</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">symm</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">strip_symmetric</span><span class="sf11b2">(</span><span class="sf3b2">actual_covariance</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">symm</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">strip_symmetric</span><span class="sf11b2">(</span><span class="sf3b2">actual_covariance</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">symm</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">symm</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">scaling_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">exp</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">scaling_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">exp</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">scaling_inverse_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">log</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">scaling_inverse_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">log</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">covariance_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">build_covariance_from_scaling_rotation</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">covariance_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">build_covariance_from_scaling_rotation</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opacity_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">sigmoid</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opacity_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">sigmoid</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">inverse_opacity_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">inverse_sigmoid</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">inverse_opacity_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">inverse_sigmoid</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">rotation_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf3b2">functional</span><span class="sf11b2">.</span><span class="sf3b2">normalize</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">rotation_activation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf3b2">functional</span><span class="sf11b2">.</span><span class="sf3b2">normalize</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">__init__</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">sh_degree</span><span class="sf11b2">&nbsp;: </span><span class="sf21b2">int</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">__init__</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">sh_degree</span><span class="sf11b2">&nbsp;: </span><span class="sf21b2">int</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">sh_degree</span><span class="sf11b2">&nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">sh_degree</span><span class="sf11b2">&nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;= </span><span class="sf20b2">None</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;= </span><span class="sf20b2">None</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;= </span><span class="sf20b2">None</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;= </span><span class="sf20b2">None</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">setup_functions</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">setup_functions</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">capture</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">capture</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;(</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;(</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_dc,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_dc,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_rest,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_rest,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf8b2">state_dict</span><span class="sf11b2">(),</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf8b2">state_dict</span><span class="sf11b2">(),</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">state_dict</span><span class="sf11b2">(),</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">state_dict</span><span class="sf11b2">(),</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; )</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; )</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">restore</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">model_args</span><span class="sf11b2">, </span><span class="sf3b2">training_args</span><span class="sf11b2">=</span><span class="sf20b2">None</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">restore</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">model_args</span><span class="sf11b2">, </span><span class="sf3b2">training_args</span><span class="sf11b2">=</span><span class="sf20b2">None</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">, </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">, </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">, </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">, </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_dc, </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_dc, </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_rest,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_rest,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">, </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">, </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">, </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">, </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">, </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">, </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">denom</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">denom</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opt_dict</span><span class="sf11b2">, </span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opt_dict</span><span class="sf11b2">, </span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">neural_renderer_state</span><span class="sf11b2">) = </span><span class="sf3b2">model_args</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">neural_renderer_state</span><span class="sf11b2">) = </span><span class="sf3b2">model_args</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">training_args</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">training_args</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">training_setup</span><span class="sf11b2">(</span><span class="sf3b2">training_args</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">training_setup</span><span class="sf11b2">(</span><span class="sf3b2">training_args</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">xyz_gradient_accum</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">xyz_gradient_accum</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">opa_gradient_accum</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">opa_gradient_accum</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">denom</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">denom</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf8b2">load_state_dict</span><span class="sf11b2">(</span><span class="sf3b2">opt_dict<wbr></span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf8b2">load_state_dict</span><span class="sf11b2">(</span><span class="sf3b2">opt_dict<wbr></span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">GridRenderer</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">GridRenderer</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">recover_from_ckpt</span><span class="sf11b2">(<wbr></span><span class="sf3b2">neural_renderer_state</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">recover_from_ckpt</span><span class="sf11b2">(<wbr></span><span class="sf3b2">neural_renderer_state</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_scaling</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_scaling</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">scaling_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">scaling_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_rotation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_rotation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">rotation_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation<wbr></span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">rotation_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation<wbr></span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_xyz</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_xyz</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_features</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_features</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">features_dc</span><span class="sf11b2">, </span><span class="sf3b2">features_rest</span><span class="sf11b2">), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">features_dc</span><span class="sf11b2">, </span><span class="sf3b2">features_rest</span><span class="sf11b2">), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># return self._features</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># return self._features</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># raise NotImplementedError</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># raise NotImplementedError</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_dino_features</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_dino_features</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_opacity</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_opacity</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># return self.opacity_activation(self._opacity)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># return self.opacity_activation(self._opacity)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">sigma</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">density</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_x<wbr>yz</span><span class="sf11b2">)[</span><span class="sf12b2">'sigma'</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">sigma</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">density</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_x<wbr>yz</span><span class="sf11b2">)[</span><span class="sf12b2">'sigma'</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">_opa_neu</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">sigma</span><span class="sf11b2">.</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">_opa_neu</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">sigma</span><span class="sf11b2">.</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">combine_opacity</span><span class="sf11b2">(</span><span class="sf3b2">_opa_neu</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">combine_opacity</span><span class="sf11b2">(</span><span class="sf3b2">_opa_neu</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_opacity_</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_opacity_</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">combine_opacity</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">opa_neu</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">combine_opacity</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">opa_neu</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opa_pnt = self.opacity_activation(self._opacity + opa_neu)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opa_pnt = self.opacity_activation(self._opacity + opa_neu)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opa_pnt</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opa_pnt</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opa_pnt = self.opacity_activation(opa_neu)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opa_pnt = self.opacity_activation(opa_neu)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># return torch.maximum(opa_neu, opa_pnt)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># return torch.maximum(opa_neu, opa_pnt)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">opa_pnt</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">opa_pnt</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; @</span><span class="sf21b2">property</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_depth_err</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_depth_err</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf3b2">functional</span><span class="sf11b2">.</span><span class="sf8b2">softplus</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_dept<wbr>h_err</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf3b2">functional</span><span class="sf11b2">.</span><span class="sf8b2">softplus</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_dept<wbr>h_err</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_covariance</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">scaling_modifier</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">1</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">get_covariance</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">scaling_modifier</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">1</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">covariance_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_sca<wbr>ling</span><span class="sf11b2">, </span><span class="sf3b2">scaling_modifier</span><span class="sf11b2">, </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">covariance_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_sca<wbr>ling</span><span class="sf11b2">, </span><span class="sf3b2">scaling_modifier</span><span class="sf11b2">, </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">oneupSHdegree</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">oneupSHdegree</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;&lt; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;&lt; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;+= </span><span class="sf10b2">1</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;+= </span><span class="sf10b2">1</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">create_from_pcd</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">pcd</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">BasicPointCloud</span><span class="sf11b2">, </span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">&nbsp;: </span><span class="sf21b2">float</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">create_from_pcd</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">pcd</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">BasicPointCloud</span><span class="sf11b2">, </span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">&nbsp;: </span><span class="sf21b2">float</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">spatial_lr_scale</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">spatial_lr_scale</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">pcd</span><span class="sf11b2">.</span><span class="sf3b2">points</span><span class="sf11b2">)).</span><span class="sf21b2">fl<wbr>oat</span><span class="sf11b2">().</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">pcd</span><span class="sf11b2">.</span><span class="sf3b2">points</span><span class="sf11b2">)).</span><span class="sf21b2">fl<wbr>oat</span><span class="sf11b2">().</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"><a id="d1" href="#d1">.</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">fused_color</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span class="sf17b18">RGB2SH(torch.tensor(</span><span style="color: #000000; background-color: #efcb05; ">np</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">asarray</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">pcd</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">colo<wbr>rs</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float</span><span style="color: #000000; background-color: #efcb05; ">().</span><span style="color: #000000; background-color: #efcb05; ">cuda</span><span style="color: #000000; background-color: #efcb05; ">())</span></code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b16">colors_np</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">np</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">asarray</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">pcd</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">colors</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18">&nbsp;if hasattr(pcd, "colors"</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18">&nbsp;else None</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; if colors_np is None or colors_np</span><span style="color: #000000; background-color: #efcb05; ">.</span><span class="sf17b18">shape[0] != fused_point_cloud.shape[0]:</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print("[Warning] Point cloud has no valid colors, initializing to zeros.")</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; colors_np = np.zeros((fused_point_cloud.shape[0], 3), dtype=np.float32)</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; fused_color = RGB2SH(torch.tensor(colors_np).</span><span style="color: #000000; background-color: #efcb05; ">float</span><span style="color: #000000; background-color: #efcb05; ">().<wbr></span><span style="color: #000000; background-color: #efcb05; ">cuda</span><span style="color: #000000; background-color: #efcb05; ">())</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">fused_color</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">3</span><span class="sf11b2">, (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span><span class="sf11b2">&nbsp;+ </span><span class="sf10b2">1</span><span class="sf11b2">) ** </span><span class="sf10b2">2</span><span class="sf11b2">)).</span><span class="sf21b2">float</span><span class="sf11b2">().</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">fused_color</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">3</span><span class="sf11b2">, (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span><span class="sf11b2">&nbsp;+ </span><span class="sf10b2">1</span><span class="sf11b2">) ** </span><span class="sf10b2">2</span><span class="sf11b2">)).</span><span class="sf21b2">float</span><span class="sf11b2">().</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features</span><span class="sf11b2">[:, :</span><span class="sf10b2">3</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">&nbsp;] = </span><span class="sf3b2">fused_color</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features</span><span class="sf11b2">[:, :</span><span class="sf10b2">3</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">&nbsp;] = </span><span class="sf3b2">fused_color</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features</span><span class="sf11b2">[:, </span><span class="sf10b2">3</span><span class="sf11b2">:, </span><span class="sf10b2">1</span><span class="sf11b2">:] = </span><span class="sf10b2">0.0</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">features</span><span class="sf11b2">[:, </span><span class="sf10b2">3</span><span class="sf11b2">:, </span><span class="sf10b2">1</span><span class="sf11b2">:] = </span><span class="sf10b2">0.0</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># features = torch.zeros((fused_point_cloud.shape[0]<wbr>, 16)).float().cuda()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># features = torch.zeros((fused_point_cloud.shape[0]<wbr>, 16)).float().cuda()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf21b2">print</span><span class="sf11b2">(</span><span class="sf12b2">"Number of points at initialisation : "</span><span class="sf11b2">, </span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">])</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf21b2">print</span><span class="sf11b2">(</span><span class="sf12b2">"Number of points at initialisation : "</span><span class="sf11b2">, </span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">])</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">dist2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">clamp_min</span><span class="sf11b2">(</span><span class="sf8b2">distCUDA2</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">from_nu<wbr>mpy</span><span class="sf11b2">(</span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">pcd</span><span class="sf11b2">.</span><span class="sf3b2">points</span><span class="sf11b2">)).</span><span class="sf21b2">float</span><span class="sf11b2">().</span><span class="sf8b2">cud<wbr>a</span><span class="sf11b2">()), </span><span class="sf10b2">0.0000001</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">dist2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">clamp_min</span><span class="sf11b2">(</span><span class="sf8b2">distCUDA2</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">from_nu<wbr>mpy</span><span class="sf11b2">(</span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">pcd</span><span class="sf11b2">.</span><span class="sf3b2">points</span><span class="sf11b2">)).</span><span class="sf21b2">float</span><span class="sf11b2">().</span><span class="sf8b2">cud<wbr>a</span><span class="sf11b2">()), </span><span class="sf10b2">0.0000001</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scales</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">log</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">sqrt</span><span class="sf11b2">(</span><span class="sf3b2">dist2</span><span class="sf11b2">))[</span><span class="sf3b2">...</span><span class="sf11b2">,</span><span class="sf20b2">None</span><span class="sf11b2">].<wbr></span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">3</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scales</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">log</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">sqrt</span><span class="sf11b2">(</span><span class="sf3b2">dist2</span><span class="sf11b2">))[</span><span class="sf3b2">...</span><span class="sf11b2">,</span><span class="sf20b2">None</span><span class="sf11b2">].<wbr></span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">3</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>, </span><span class="sf10b2">4</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>, </span><span class="sf10b2">4</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">[:, </span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf10b2">1</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">[:, </span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf10b2">1</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a id="d2" href="#d2">.</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">opacities</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">inverse_sigmoid</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">0.1</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">* </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">ones</span><span style="color: #000000; background-color: #efcb05; ">((</span><span class="sf17b16">fused_point_cloud.shape[0]</span><span style="color: #000000; background-color: #efcb05; ">,<wbr> </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">"cuda"</span><span style="color: #000000; background-color: #efcb05; ">)</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf17b18">num_points = fused_point_cloud.shape[0]</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; colmap_count = min(10000, num_points)</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; if num_points &gt; colmap_count:</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">opacities</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span class="sf17b18">torch.empty((num_points, 1), dtype=torch.float, device="cuda")</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; opacities[:colmap_count] = </span><span style="color: #000000; background-color: #efcb05; ">inverse_sigmoid</span><span style="color: #000000; background-color: #efcb05; ">(</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; torch.full((colmap_count, 1), </span><span style="color: #000000; background-color: #efcb05; ">0.1</span><span class="sf17b18">,</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span class="sf17b18">dtype=torch.float, device="cuda")</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; opacities[colmap_count:] = inverse_sigmoid(</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; torch.full((num_points - colmap_count, 1), 0.01, dtype=torch.float, device="cuda")</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; else:</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; opacities = inverse_sigmoid(</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.1 </span><span style="color: #000000; background-color: #efcb05; ">* </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">ones</span><span style="color: #000000; background-color: #efcb05; ">((</span><span class="sf17b16">num_points</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">"cuda"</span><span style="color: #000000; background-color: #efcb05; ">)</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">.</span><span class="sf8b2">requires<wbr>_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">fused_point_cloud</span><span class="sf11b2">.</span><span class="sf8b2">requires<wbr>_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">features</span><span class="sf11b2">[:,:,</span><span class="sf10b2">0</span><span class="sf11b2">:</span><span class="sf10b2">1</span><span class="sf11b2">].</span><span class="sf8b2">transpos<wbr>e</span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">2</span><span class="sf11b2">).</span><span class="sf8b2">contiguous</span><span class="sf11b2">().</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">features</span><span class="sf11b2">[:,:,</span><span class="sf10b2">0</span><span class="sf11b2">:</span><span class="sf10b2">1</span><span class="sf11b2">].</span><span class="sf8b2">transpos<wbr>e</span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">2</span><span class="sf11b2">).</span><span class="sf8b2">contiguous</span><span class="sf11b2">().</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">features</span><span class="sf11b2">[:,:,</span><span class="sf10b2">1</span><span class="sf11b2">:].</span><span class="sf8b2">transpose<wbr></span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">2</span><span class="sf11b2">).</span><span class="sf8b2">contiguous</span><span class="sf11b2">().</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">features</span><span class="sf11b2">[:,:,</span><span class="sf10b2">1</span><span class="sf11b2">:].</span><span class="sf8b2">transpose<wbr></span><span class="sf11b2">(</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf10b2">2</span><span class="sf11b2">).</span><span class="sf8b2">contiguous</span><span class="sf11b2">().</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">fused_point_c<wbr>loud</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">32</span><span class="sf11b2">)).</span><span class="sf21b2">float</span><span class="sf11b2">().</span><span class="sf8b2">cuda</span><span class="sf11b2">().</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True<wbr></span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">fused_point_c<wbr>loud</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">32</span><span class="sf11b2">)).</span><span class="sf21b2">float</span><span class="sf11b2">().</span><span class="sf8b2">cuda</span><span class="sf11b2">().</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True<wbr></span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">scales</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True<wbr></span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">scales</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True<wbr></span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">rots</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))<wbr></span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">rots</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))<wbr></span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">opacities</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">T<wbr>rue</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">opacities</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">T<wbr>rue</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">opacities<wbr></span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">opacities<wbr></span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">GridRenderer</span><span class="sf11b2">(</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">GridRenderer</span><span class="sf11b2">(</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">bound</span><span class="sf11b2">=((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">-</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_x<wbr>yz</span><span class="sf11b2">.</span><span class="sf21b2">min</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">).</span><span class="sf21b2">max</span><span class="sf11b2">())/</span><span class="sf10b2">2</span><span class="sf11b2">&nbsp;* </span><span class="sf10b2">1.2</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">bound</span><span class="sf11b2">=((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">-</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_x<wbr>yz</span><span class="sf11b2">.</span><span class="sf21b2">min</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">).</span><span class="sf21b2">max</span><span class="sf11b2">())/</span><span class="sf10b2">2</span><span class="sf11b2">&nbsp;* </span><span class="sf10b2">1.2</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"><a id="d3" href="#d3">.</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">coord_center</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_xyz</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">mean</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">coord_center</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_xyz</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">mean</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span><span class="sf17b18">,</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span class="sf17b18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keep_sigma=True</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ).</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ).</span><span class="sf8b2">cuda</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">training_setup</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">training_args</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">training_setup</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">training_args</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">&nbsp;= [</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">&nbsp;= [</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr_init</span><span class="sf11b2">&nbsp;* </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"xyz"</span><span class="sf11b2">},</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr_init</span><span class="sf11b2">&nbsp;* </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"xyz"</span><span class="sf11b2">},</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">feature_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"f_dc"</span><span class="sf11b2">},</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">feature_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"f_dc"</span><span class="sf11b2">},</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">feature_lr</span><span class="sf11b2">&nbsp;/ </span><span class="sf10b2">20.0</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"f_rest"</span><span class="sf11b2">},</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">feature_lr</span><span class="sf11b2">&nbsp;/ </span><span class="sf10b2">20.0</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"f_rest"</span><span class="sf11b2">},</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf10b2">0.001</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"features"</span><span class="sf11b2">},</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf10b2">0.001</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"features"</span><span class="sf11b2">},</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">opacity_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"opacity"</span><span class="sf11b2">},</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">opacity_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"opacity"</span><span class="sf11b2">},</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">scaling_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"depth_err"</span><span class="sf11b2">},</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">scaling_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"depth_err"</span><span class="sf11b2">},</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">scaling_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"scaling"</span><span class="sf11b2">},</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">scaling_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"scaling"</span><span class="sf11b2">},</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">rotation_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"rotation"</span><span class="sf11b2">}</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="sf12b2">'params'</span><span class="sf11b2">: [</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">], </span><span class="sf12b2">'lr'</span><span class="sf11b2">: </span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">rotation_lr</span><span class="sf11b2">, </span><span class="sf12b2">"name"</span><span class="sf11b2">: </span><span class="sf12b2">"rotation"</span><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; ]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; ]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">&nbsp;+= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">get_params</span><span class="sf11b2">(</span><span class="sf3b2">lr</span><span class="sf11b2">=</span><span class="sf3b2">trai<wbr>ning_args</span><span class="sf11b2">.</span><span class="sf3b2">neural_grid</span><span class="sf11b2">, </span><span class="sf3b2">lr_net</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">neural_net</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">&nbsp;+= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">neural_renderer</span><span class="sf11b2">.</span><span class="sf8b2">get_params</span><span class="sf11b2">(</span><span class="sf3b2">lr</span><span class="sf11b2">=</span><span class="sf3b2">trai<wbr>ning_args</span><span class="sf11b2">.</span><span class="sf3b2">neural_grid</span><span class="sf11b2">, </span><span class="sf3b2">lr_net</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">neural_net</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">optim</span><span class="sf11b2">.</span><span class="sf8b2">Adam</span><span class="sf11b2">(</span><span class="sf3b2">l</span><span class="sf11b2">, </span><span class="sf3b2">lr</span><span class="sf11b2">=</span><span class="sf10b2">0.0</span><span class="sf11b2">, </span><span class="sf3b2">eps</span><span class="sf11b2">=</span><span class="sf10b2">1e</span><span class="sf11b2">-</span><span class="sf10b2">15</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">optim</span><span class="sf11b2">.</span><span class="sf8b2">Adam</span><span class="sf11b2">(</span><span class="sf3b2">l</span><span class="sf11b2">, </span><span class="sf3b2">lr</span><span class="sf11b2">=</span><span class="sf10b2">0.0</span><span class="sf11b2">, </span><span class="sf3b2">eps</span><span class="sf11b2">=</span><span class="sf10b2">1e</span><span class="sf11b2">-</span><span class="sf10b2">15</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_scheduler_args</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">get_expon_lr_func</span><span class="sf11b2">(</span><span class="sf3b2">lr_init</span><span class="sf11b2">=</span><span class="sf3b2">training_args<wbr></span><span class="sf11b2">.</span><span class="sf3b2">position_lr_init</span><span class="sf11b2">*</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale<wbr></span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_scheduler_args</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">get_expon_lr_func</span><span class="sf11b2">(</span><span class="sf3b2">lr_init</span><span class="sf11b2">=</span><span class="sf3b2">training_args<wbr></span><span class="sf11b2">.</span><span class="sf3b2">position_lr_init</span><span class="sf11b2">*</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale<wbr></span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr_final</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr_fina<wbr>l</span><span class="sf11b2">*</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr_final</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr_fina<wbr>l</span><span class="sf11b2">*</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">spatial_lr_scale</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr_delay_steps</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_l<wbr>r_delay_steps</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr_delay_steps</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_l<wbr>r_delay_steps</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr_delay_mult</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr<wbr>_delay_mult</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr_delay_mult</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr<wbr>_delay_mult</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">max_steps</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr_max<wbr>_steps</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">max_steps</span><span class="sf11b2">=</span><span class="sf3b2">training_args</span><span class="sf11b2">.</span><span class="sf3b2">position_lr_max<wbr>_steps</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">update_learning_rate</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">iteration</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">update_learning_rate</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">iteration</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">''' Learning rate scheduling per step '''</span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">''' Learning rate scheduling per step '''</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">param_group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">param_group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">param_group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">] == </span><span class="sf12b2">"xyz"</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">param_group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">] == </span><span class="sf12b2">"xyz"</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">xyz_scheduler_args</span><span class="sf11b2">(</span><span class="sf3b2">iteration</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">lr</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">xyz_scheduler_args</span><span class="sf11b2">(</span><span class="sf3b2">iteration</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">param_group</span><span class="sf11b2">[</span><span class="sf12b2">'lr'</span><span class="sf11b2">] = </span><span class="sf3b2">lr</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">param_group</span><span class="sf11b2">[</span><span class="sf12b2">'lr'</span><span class="sf11b2">] = </span><span class="sf3b2">lr</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">lr</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">lr</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">construct_list_of_attributes</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">construct_list_of_attributes</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">&nbsp;= [</span><span class="sf12b2">'x'</span><span class="sf11b2">, </span><span class="sf12b2">'y'</span><span class="sf11b2">, </span><span class="sf12b2">'z'</span><span class="sf11b2">, </span><span class="sf12b2">'nx'</span><span class="sf11b2">, </span><span class="sf12b2">'ny'</span><span class="sf11b2">, </span><span class="sf12b2">'nz'</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">&nbsp;= [</span><span class="sf12b2">'x'</span><span class="sf11b2">, </span><span class="sf12b2">'y'</span><span class="sf11b2">, </span><span class="sf12b2">'z'</span><span class="sf11b2">, </span><span class="sf12b2">'nx'</span><span class="sf11b2">, </span><span class="sf12b2">'ny'</span><span class="sf11b2">, </span><span class="sf12b2">'nz'</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># All channels except the 3 DC</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># All channels except the 3 DC</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># for i in range(self._features_dc.shape[1]*self._<wbr>features_dc.shape[2]):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># for i in range(self._features_dc.shape[1]*self._<wbr>features_dc.shape[2]):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; l.append('f_dc_{}'.format(i))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; l.append('f_dc_{}'.format(i))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># for i in range(self._features_rest.shape[1]*self<wbr>._features_rest.shape[2]):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># for i in range(self._features_rest.shape[1]*self<wbr>._features_rest.shape[2]):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; l.append('f_rest_{}'.format(i))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; l.append('f_rest_{}'.format(i))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># for i in range(self._features.shape[1]):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># for i in range(self._features.shape[1]):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; l.append('features_{}'.format(i))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; l.append('features_{}'.format(i))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">.</span><span class="sf8b2">append</span><span class="sf11b2">(</span><span class="sf12b2">'opacity'</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">.</span><span class="sf8b2">append</span><span class="sf11b2">(</span><span class="sf12b2">'opacity'</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">range</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">1</span><span class="sf11b2">]):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">range</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">1</span><span class="sf11b2">]):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">.</span><span class="sf8b2">append</span><span class="sf11b2">(</span><span class="sf12b2">'scale_{}'</span><span class="sf11b2">.</span><span class="sf21b2">format</span><span class="sf11b2">(</span><span class="sf3b2">i</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">.</span><span class="sf8b2">append</span><span class="sf11b2">(</span><span class="sf12b2">'scale_{}'</span><span class="sf11b2">.</span><span class="sf21b2">format</span><span class="sf11b2">(</span><span class="sf3b2">i</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">range</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">1</span><span class="sf11b2">]):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">range</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">1</span><span class="sf11b2">]):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">.</span><span class="sf8b2">append</span><span class="sf11b2">(</span><span class="sf12b2">'rot_{}'</span><span class="sf11b2">.</span><span class="sf21b2">format</span><span class="sf11b2">(</span><span class="sf3b2">i</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">l</span><span class="sf11b2">.</span><span class="sf8b2">append</span><span class="sf11b2">(</span><span class="sf12b2">'rot_{}'</span><span class="sf11b2">.</span><span class="sf21b2">format</span><span class="sf11b2">(</span><span class="sf3b2">i</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">l</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">l</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">save_ply</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf20b2">path</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">save_ply</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf20b2">path</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">mkdir_p</span><span class="sf11b2">(</span><span class="sf3b2">os</span><span class="sf11b2">.</span><span class="sf20b2">path</span><span class="sf11b2">.</span><span class="sf8b2">dirname</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">mkdir_p</span><span class="sf11b2">(</span><span class="sf3b2">os</span><span class="sf11b2">.</span><span class="sf20b2">path</span><span class="sf11b2">.</span><span class="sf8b2">dirname</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">normals</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">normals</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_dc = self._features_dc.detach().transpose(1,<wbr> 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_dc = self._features_dc.detach().transpose(1,<wbr> 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_rest = self._features_rest.detach().transpose(<wbr>1, 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_rest = self._features_rest.detach().transpose(<wbr>1, 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opacities = self._opacity.detach().cpu().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opacities = self._opacity.detach().cpu().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># features = self._features.detach().cpu().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># features = self._features.detach().cpu().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">inverse_opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">ge<wbr>t_opacity</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">()).</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">inverse_opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">ge<wbr>t_opacity</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">()).</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">dtype_full</span><span class="sf11b2">&nbsp;= [(</span><span class="sf3b2">attribute</span><span class="sf11b2">, </span><span class="sf12b2">'f4'</span><span class="sf11b2">) </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">attribute</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">construct_list_of_attributes</span><span class="sf11b2">()]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">dtype_full</span><span class="sf11b2">&nbsp;= [(</span><span class="sf3b2">attribute</span><span class="sf11b2">, </span><span class="sf12b2">'f4'</span><span class="sf11b2">) </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">attribute</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">construct_list_of_attributes</span><span class="sf11b2">()]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">dtype_full</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">dtype_full</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">attributes</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">concatenate</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">, </span><span class="sf3b2">normals</span><span class="sf11b2">, </span><span class="sf3b2">opacities</span><span class="sf11b2">, </span><span class="sf3b2">scale</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">), </span><span class="sf3b2">axis</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">attributes</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">concatenate</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">, </span><span class="sf3b2">normals</span><span class="sf11b2">, </span><span class="sf3b2">opacities</span><span class="sf11b2">, </span><span class="sf3b2">scale</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">), </span><span class="sf3b2">axis</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">[:] = </span><span class="sf21b2">list</span><span class="sf11b2">(</span><span class="sf21b2">map</span><span class="sf11b2">(</span><span class="sf21b2">tuple</span><span class="sf11b2">, </span><span class="sf3b2">attributes</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">[:] = </span><span class="sf21b2">list</span><span class="sf11b2">(</span><span class="sf21b2">map</span><span class="sf11b2">(</span><span class="sf21b2">tuple</span><span class="sf11b2">, </span><span class="sf3b2">attributes</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">el</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">PlyElement</span><span class="sf11b2">.</span><span class="sf8b2">describe</span><span class="sf11b2">(</span><span class="sf3b2">elements</span><span class="sf11b2">, </span><span class="sf12b2">'vertex'</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">el</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">PlyElement</span><span class="sf11b2">.</span><span class="sf8b2">describe</span><span class="sf11b2">(</span><span class="sf3b2">elements</span><span class="sf11b2">, </span><span class="sf12b2">'vertex'</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">PlyData</span><span class="sf11b2">([</span><span class="sf3b2">el</span><span class="sf11b2">]).</span><span class="sf8b2">write</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">PlyData</span><span class="sf11b2">([</span><span class="sf3b2">el</span><span class="sf11b2">]).</span><span class="sf8b2">write</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">save_ply_color</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf20b2">path</span><span class="sf11b2">, </span><span class="sf3b2">color</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">save_ply_color</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf20b2">path</span><span class="sf11b2">, </span><span class="sf3b2">color</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">mkdir_p</span><span class="sf11b2">(</span><span class="sf3b2">os</span><span class="sf11b2">.</span><span class="sf20b2">path</span><span class="sf11b2">.</span><span class="sf8b2">dirname</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">mkdir_p</span><span class="sf11b2">(</span><span class="sf3b2">os</span><span class="sf11b2">.</span><span class="sf20b2">path</span><span class="sf11b2">.</span><span class="sf8b2">dirname</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">normals</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">normals</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_dc = self._features_dc.detach().transpose(1,<wbr> 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_dc = self._features_dc.detach().transpose(1,<wbr> 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_rest = self._features_rest.detach().transpose(<wbr>1, 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># f_rest = self._features_rest.detach().transpose(<wbr>1, 2).flatten(start_dim=1).contiguous().cp<wbr>u().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opacities = self._opacity.detach().cpu().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># opacities = self._opacity.detach().cpu().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># features = self._features.detach().cpu().numpy()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># features = self._features.detach().cpu().numpy()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">inverse_opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">ge<wbr>t_opacity</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">()).</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">inverse_opacity_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">ge<wbr>t_opacity</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">()).</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">color</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">color</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">color</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">color</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">().</span><span class="sf8b2">cpu</span><span class="sf11b2">().</span><span class="sf8b2">numpy</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">dtype_full</span><span class="sf11b2">&nbsp;= [(</span><span class="sf3b2">attribute</span><span class="sf11b2">, </span><span class="sf12b2">'f4'</span><span class="sf11b2">) </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">attribute</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">construct_list_of_attributes</span><span class="sf11b2">()] + [(</span><span class="sf3b2">ch</span><span class="sf11b2">, </span><span class="sf12b2">"u1"</span><span class="sf11b2">) </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ch</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;[</span><span class="sf12b2">'red'</span><span class="sf11b2">, </span><span class="sf12b2">'green'</span><span class="sf11b2">, </span><span class="sf12b2">'blue'</span><span class="sf11b2">]]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">dtype_full</span><span class="sf11b2">&nbsp;= [(</span><span class="sf3b2">attribute</span><span class="sf11b2">, </span><span class="sf12b2">'f4'</span><span class="sf11b2">) </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">attribute</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">construct_list_of_attributes</span><span class="sf11b2">()] + [(</span><span class="sf3b2">ch</span><span class="sf11b2">, </span><span class="sf12b2">"u1"</span><span class="sf11b2">) </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ch</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;[</span><span class="sf12b2">'red'</span><span class="sf11b2">, </span><span class="sf12b2">'green'</span><span class="sf11b2">, </span><span class="sf12b2">'blue'</span><span class="sf11b2">]]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">dtype_full</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">empty</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">dtype_full</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">attributes</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">concatenate</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">, </span><span class="sf3b2">normals</span><span class="sf11b2">, </span><span class="sf3b2">opacities</span><span class="sf11b2">, </span><span class="sf3b2">scale</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">, </span><span class="sf3b2">color</span><span class="sf11b2">&nbsp;* </span><span class="sf10b2">255</span><span class="sf11b2">), </span><span class="sf3b2">axis</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">attributes</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">concatenate</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">, </span><span class="sf3b2">normals</span><span class="sf11b2">, </span><span class="sf3b2">opacities</span><span class="sf11b2">, </span><span class="sf3b2">scale</span><span class="sf11b2">, </span><span class="sf3b2">rotation</span><span class="sf11b2">, </span><span class="sf3b2">color</span><span class="sf11b2">&nbsp;* </span><span class="sf10b2">255</span><span class="sf11b2">), </span><span class="sf3b2">axis</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">[:] = </span><span class="sf21b2">list</span><span class="sf11b2">(</span><span class="sf21b2">map</span><span class="sf11b2">(</span><span class="sf21b2">tuple</span><span class="sf11b2">, </span><span class="sf3b2">attributes</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">elements</span><span class="sf11b2">[:] = </span><span class="sf21b2">list</span><span class="sf11b2">(</span><span class="sf21b2">map</span><span class="sf11b2">(</span><span class="sf21b2">tuple</span><span class="sf11b2">, </span><span class="sf3b2">attributes</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">el</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">PlyElement</span><span class="sf11b2">.</span><span class="sf8b2">describe</span><span class="sf11b2">(</span><span class="sf3b2">elements</span><span class="sf11b2">, </span><span class="sf12b2">'vertex'</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">el</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">PlyElement</span><span class="sf11b2">.</span><span class="sf8b2">describe</span><span class="sf11b2">(</span><span class="sf3b2">elements</span><span class="sf11b2">, </span><span class="sf12b2">'vertex'</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">PlyData</span><span class="sf11b2">([</span><span class="sf3b2">el</span><span class="sf11b2">]).</span><span class="sf8b2">write</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">PlyData</span><span class="sf11b2">([</span><span class="sf3b2">el</span><span class="sf11b2">]).</span><span class="sf8b2">write</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">reset_opacity</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">value</span><span class="sf11b2">=</span><span class="sf10b2">0.01</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">reset_opacity</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">value</span><span class="sf11b2">=</span><span class="sf10b2">0.01</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities_new</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">inverse_sigmoid</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">min</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opac<wbr>ity</span><span class="sf11b2">, </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">ones_like</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">)*</span><span class="sf3b2">value<wbr></span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities_new</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">inverse_sigmoid</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">min</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opac<wbr>ity</span><span class="sf11b2">, </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">ones_like</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">)*</span><span class="sf3b2">value<wbr></span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">replace_tensor_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">opacit<wbr>ies_new</span><span class="sf11b2">, </span><span class="sf12b2">"opacity"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">replace_tensor_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">opacit<wbr>ies_new</span><span class="sf11b2">, </span><span class="sf12b2">"opacity"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># raise NotImplementedError</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># raise NotImplementedError</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">reset_opacity_max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">value</span><span class="sf11b2">=</span><span class="sf10b2">0.8</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">reset_opacity_max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">value</span><span class="sf11b2">=</span><span class="sf10b2">0.8</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities_new</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">inverse_sigmoid</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opac<wbr>ity</span><span class="sf11b2">, </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">ones_like</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">)*</span><span class="sf3b2">value<wbr></span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities_new</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">inverse_sigmoid</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opac<wbr>ity</span><span class="sf11b2">, </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">ones_like</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">)*</span><span class="sf3b2">value<wbr></span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">replace_tensor_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">opacit<wbr>ies_new</span><span class="sf11b2">, </span><span class="sf12b2">"opacity"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">replace_tensor_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">opacit<wbr>ies_new</span><span class="sf11b2">, </span><span class="sf12b2">"opacity"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># raise NotImplementedError</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># raise NotImplementedError</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">load_ply</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf20b2">path</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">load_ply</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf20b2">path</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">plydata</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">PlyData</span><span class="sf11b2">.</span><span class="sf8b2">read</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">plydata</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">PlyData</span><span class="sf11b2">.</span><span class="sf8b2">read</span><span class="sf11b2">(</span><span class="sf20b2">path</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">stack</span><span class="sf11b2">((</span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0<wbr></span><span class="sf11b2">][</span><span class="sf12b2">"x"</span><span class="sf11b2">]),</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">stack</span><span class="sf11b2">((</span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0<wbr></span><span class="sf11b2">][</span><span class="sf12b2">"x"</span><span class="sf11b2">]),</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf12b2">"y"</span><span class="sf11b2">]),</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf12b2">"y"</span><span class="sf11b2">]),</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf12b2">"z"</span><span class="sf11b2">])), &nbsp;</span><span class="sf3b2">axis</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf12b2">"z"</span><span class="sf11b2">])), &nbsp;</span><span class="sf3b2">axis</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf12b2">"opacity<wbr>"</span><span class="sf11b2">])[</span><span class="sf3b2">...</span><span class="sf11b2">, </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf3b2">newaxis</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf12b2">"opacity<wbr>"</span><span class="sf11b2">])[</span><span class="sf3b2">...</span><span class="sf11b2">, </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf3b2">newaxis</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale_names</span><span class="sf11b2">&nbsp;= [</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">].</span><span class="sf3b2">properties</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">.</span><span class="sf8b2">startswith</span><span class="sf11b2">(</span><span class="sf12b2">"scale_"</span><span class="sf11b2">)]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale_names</span><span class="sf11b2">&nbsp;= [</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">].</span><span class="sf3b2">properties</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">.</span><span class="sf8b2">startswith</span><span class="sf11b2">(</span><span class="sf12b2">"scale_"</span><span class="sf11b2">)]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale_names</span><span class="sf11b2">&nbsp;= </span><span class="sf21b2">sorted</span><span class="sf11b2">(</span><span class="sf3b2">scale_names</span><span class="sf11b2">, </span><span class="sf3b2">key</span><span class="sf11b2">&nbsp;= </span><span class="sf7b2">lambda</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">x</span><span class="sf11b2">: </span><span class="sf21b2">int</span><span class="sf11b2">(</span><span class="sf3b2">x</span><span class="sf11b2">.</span><span class="sf8b2">split</span><span class="sf11b2">(</span><span class="sf12b2">'_'</span><span class="sf11b2">)[-</span><span class="sf10b2">1</span><span class="sf11b2">]))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scale_names</span><span class="sf11b2">&nbsp;= </span><span class="sf21b2">sorted</span><span class="sf11b2">(</span><span class="sf3b2">scale_names</span><span class="sf11b2">, </span><span class="sf3b2">key</span><span class="sf11b2">&nbsp;= </span><span class="sf7b2">lambda</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">x</span><span class="sf11b2">: </span><span class="sf21b2">int</span><span class="sf11b2">(</span><span class="sf3b2">x</span><span class="sf11b2">.</span><span class="sf8b2">split</span><span class="sf11b2">(</span><span class="sf12b2">'_'</span><span class="sf11b2">)[-</span><span class="sf10b2">1</span><span class="sf11b2">]))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scales</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf21b2">len</span><span class="sf11b2">(</span><span class="sf3b2">scale_names</span><span class="sf11b2">)))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scales</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf21b2">len</span><span class="sf11b2">(</span><span class="sf3b2">scale_names</span><span class="sf11b2">)))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">idx</span><span class="sf11b2">, </span><span class="sf3b2">attr_name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">enumerate</span><span class="sf11b2">(</span><span class="sf3b2">scale_names</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">idx</span><span class="sf11b2">, </span><span class="sf3b2">attr_name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">enumerate</span><span class="sf11b2">(</span><span class="sf3b2">scale_names</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scales</span><span class="sf11b2">[:, </span><span class="sf3b2">idx</span><span class="sf11b2">] = </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">attr_nam<wbr>e</span><span class="sf11b2">])</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">scales</span><span class="sf11b2">[:, </span><span class="sf3b2">idx</span><span class="sf11b2">] = </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">attr_nam<wbr>e</span><span class="sf11b2">])</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rot_names</span><span class="sf11b2">&nbsp;= [</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">].</span><span class="sf3b2">properties</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">.</span><span class="sf8b2">startswith</span><span class="sf11b2">(</span><span class="sf12b2">"rot"</span><span class="sf11b2">)]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rot_names</span><span class="sf11b2">&nbsp;= [</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">].</span><span class="sf3b2">properties</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">p</span><span class="sf11b2">.</span><span class="sf3b2">name</span><span class="sf11b2">.</span><span class="sf8b2">startswith</span><span class="sf11b2">(</span><span class="sf12b2">"rot"</span><span class="sf11b2">)]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rot_names</span><span class="sf11b2">&nbsp;= </span><span class="sf21b2">sorted</span><span class="sf11b2">(</span><span class="sf3b2">rot_names</span><span class="sf11b2">, </span><span class="sf3b2">key</span><span class="sf11b2">&nbsp;= </span><span class="sf7b2">lambda</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">x</span><span class="sf11b2">: </span><span class="sf21b2">int</span><span class="sf11b2">(</span><span class="sf3b2">x</span><span class="sf11b2">.</span><span class="sf8b2">split</span><span class="sf11b2">(</span><span class="sf12b2">'_'</span><span class="sf11b2">)[-</span><span class="sf10b2">1</span><span class="sf11b2">]))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rot_names</span><span class="sf11b2">&nbsp;= </span><span class="sf21b2">sorted</span><span class="sf11b2">(</span><span class="sf3b2">rot_names</span><span class="sf11b2">, </span><span class="sf3b2">key</span><span class="sf11b2">&nbsp;= </span><span class="sf7b2">lambda</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">x</span><span class="sf11b2">: </span><span class="sf21b2">int</span><span class="sf11b2">(</span><span class="sf3b2">x</span><span class="sf11b2">.</span><span class="sf8b2">split</span><span class="sf11b2">(</span><span class="sf12b2">'_'</span><span class="sf11b2">)[-</span><span class="sf10b2">1</span><span class="sf11b2">]))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf21b2">len</span><span class="sf11b2">(</span><span class="sf3b2">rot_names</span><span class="sf11b2">)))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf21b2">len</span><span class="sf11b2">(</span><span class="sf3b2">rot_names</span><span class="sf11b2">)))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">idx</span><span class="sf11b2">, </span><span class="sf3b2">attr_name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">enumerate</span><span class="sf11b2">(</span><span class="sf3b2">rot_names</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">idx</span><span class="sf11b2">, </span><span class="sf3b2">attr_name</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">enumerate</span><span class="sf11b2">(</span><span class="sf3b2">rot_names</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">[:, </span><span class="sf3b2">idx</span><span class="sf11b2">] = </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">attr_nam<wbr>e</span><span class="sf11b2">])</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">[:, </span><span class="sf3b2">idx</span><span class="sf11b2">] = </span><span class="sf3b2">np</span><span class="sf11b2">.</span><span class="sf8b2">asarray</span><span class="sf11b2">(</span><span class="sf3b2">plydata</span><span class="sf11b2">.</span><span class="sf3b2">elements</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">attr_nam<wbr>e</span><span class="sf11b2">])</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">xyz</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_dc = nn.Parameter(torch.tensor(features_dc, dtype=torch.float, device="cuda").transpose(1, 2).contiguous().requires_grad_(True))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_dc = nn.Parameter(torch.tensor(features_dc, dtype=torch.float, device="cuda").transpose(1, 2).contiguous().requires_grad_(True))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_rest = nn.Parameter(torch.tensor(features_extr<wbr>a, dtype=torch.float, device="cuda").transpose(1, 2).contiguous().requires_grad_(True))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features_rest = nn.Parameter(torch.tensor(features_extr<wbr>a, dtype=torch.float, device="cuda").transpose(1, 2).contiguous().requires_grad_(True))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features = nn.Parameter(torch.tensor(features, dtype=torch.float, device="cuda").requires_grad_(True))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># self._features = nn.Parameter(torch.tensor(features, dtype=torch.float, device="cuda").requires_grad_(True))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">opacities</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">opacities</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">scales</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">scales</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">rots</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">tensor</span><span class="sf11b2">(</span><span class="sf3b2">rots</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">float</span><span class="sf11b2">, </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">active_sh_degree</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_sh_degree</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">replace_tensor_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">tensor</span><span class="sf11b2">, </span><span class="sf3b2">name</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">replace_tensor_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">tensor</span><span class="sf11b2">, </span><span class="sf3b2">name</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= {}</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= {}</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">] == </span><span class="sf3b2">name</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">] == </span><span class="sf3b2">name</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">.</span><span class="sf8b2">get</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'<wbr></span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf20b2">None</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">.</span><span class="sf8b2">get</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'<wbr></span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf20b2">None</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">: </span><span class="sf7b2">continue</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">: </span><span class="sf7b2">continue</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">tensor</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">tensor</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">tensor</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">tensor</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">del</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">del</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">tensor</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True<wbr></span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">tensor</span><span class="sf11b2">.</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True<wbr></span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>] = </span><span class="sf3b2">stored_state</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>] = </span><span class="sf3b2">stored_state</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">optimizable_tensors</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">optimizable_tensors</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">_prune_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">mask</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">_prune_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">mask</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= {}</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= {}</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf12b2">'neural'</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]: </span><span class="sf7b2">continue</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf12b2">'neural'</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]: </span><span class="sf7b2">continue</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">.</span><span class="sf8b2">get</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'<wbr></span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf20b2">None</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">.</span><span class="sf8b2">get</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'<wbr></span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf20b2">None</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">] = </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">] = </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">] = </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">] = </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">del</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">del</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">((</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">].<wbr></span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">)))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">((</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">].<wbr></span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">)))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>] = </span><span class="sf3b2">stored_state</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>] = </span><span class="sf3b2">stored_state</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">else</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">else</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">].</span><span class="sf8b2">r<wbr>equires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">][</span><span class="sf3b2">mask</span><span class="sf11b2">].</span><span class="sf8b2">r<wbr>equires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">optimizable_tensors</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">optimizable_tensors</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">mask</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">mask</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">&nbsp;= ~</span><span class="sf3b2">mask</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">&nbsp;= ~</span><span class="sf3b2">mask</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">_prune_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">valid_points_mask<wbr></span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">_prune_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">valid_points_mask<wbr></span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"xyz"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"xyz"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_dc"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_dc"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_rest"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_rest"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"features"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"features"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"depth_err"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"depth_err"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"scaling"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"scaling"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"rotation"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"rotation"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_ma<wbr>sk</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_ma<wbr>sk</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_ma<wbr>sk</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_ma<wbr>sk</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">prune_points_inference</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">mask</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">prune_points_inference</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">mask</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">&nbsp;= ~</span><span class="sf3b2">mask</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">&nbsp;= ~</span><span class="sf3b2">mask</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand</span><span class="sf11b2">(</span><span class="sf3b2">self<wbr></span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">3</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand</span><span class="sf11b2">(</span><span class="sf3b2">self<wbr></span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">3</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand</span><span class="sf11b2">(<wbr></span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand</span><span class="sf11b2">(<wbr></span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand</span><span class="sf11b2">(<wbr></span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">3</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand</span><span class="sf11b2">(<wbr></span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">3</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand<wbr></span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">4</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">valid_points_mask</span><span class="sf11b2">.</span><span class="sf8b2">expand<wbr></span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)].</span><span class="sf8b2">view</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">4</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">cat_tensors_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">tensors_dict</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">cat_tensors_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">tensors_dict</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= {}</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= {}</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">param_groups</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf12b2">'neural'</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]: </span><span class="sf7b2">continue</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf12b2">'neural'</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">in</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]: </span><span class="sf7b2">continue</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">assert</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">len</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">]) == </span><span class="sf10b2">1</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">assert</span><span class="sf11b2">&nbsp;</span><span class="sf21b2">len</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">]) == </span><span class="sf10b2">1</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">extension_tensor</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">tensors_dict</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">extension_tensor</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">tensors_dict</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">.</span><span class="sf8b2">get</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'<wbr></span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf20b2">None</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">.</span><span class="sf8b2">get</span><span class="sf11b2">(</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'<wbr></span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf20b2">None</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">stored_state</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">], </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">extension_tensor</span><span class="sf11b2">)), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg"</span><span class="sf11b2">], </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">extension_tensor</span><span class="sf11b2">)), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">], </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">extension_tensor</span><span class="sf11b2">)), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">] = </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">stored_state</span><span class="sf11b2">[</span><span class="sf12b2">"exp_avg_sq"</span><span class="sf11b2">], </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros_like</span><span class="sf11b2">(</span><span class="sf3b2">extension_tensor</span><span class="sf11b2">)), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">del</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">del</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">]<wbr>[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">extension_tensor</span><span class="sf11b2">), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">]<wbr>[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">extension_tensor</span><span class="sf11b2">), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>] = </span><span class="sf3b2">stored_state</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">optimizer</span><span class="sf11b2">.</span><span class="sf3b2">state</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">'params'</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]<wbr>] = </span><span class="sf3b2">stored_state</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">else</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">else</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">]<wbr>[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">extension_tensor</span><span class="sf11b2">), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">] = </span><span class="sf3b2">nn</span><span class="sf11b2">.</span><span class="sf8b2">Parameter</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">]<wbr>[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf3b2">extension_tensor</span><span class="sf11b2">), </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">0</span><span class="sf11b2">).</span><span class="sf8b2">requires_grad_</span><span class="sf11b2">(</span><span class="sf20b2">True</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"name"</span><span class="sf11b2">]] = </span><span class="sf3b2">group</span><span class="sf11b2">[</span><span class="sf12b2">"params"</span><span class="sf11b2">][</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">optimizable_tensors</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">optimizable_tensors</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densification_postfix</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">new_xyz</span><span class="sf11b2">, </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">, </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">, </span><span class="sf3b2">new_features</span><span class="sf11b2">, </span><span class="sf3b2">new_opacities</span><span class="sf11b2">, </span><span class="sf3b2">new_scaling</span><span class="sf11b2">, </span><span class="sf3b2">new_rotation</span><span class="sf11b2">, </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densification_postfix</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">new_xyz</span><span class="sf11b2">, </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">, </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">, </span><span class="sf3b2">new_features</span><span class="sf11b2">, </span><span class="sf3b2">new_opacities</span><span class="sf11b2">, </span><span class="sf3b2">new_scaling</span><span class="sf11b2">, </span><span class="sf3b2">new_rotation</span><span class="sf11b2">, </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">d</span><span class="sf11b2">&nbsp;= {</span><span class="sf12b2">"xyz"</span><span class="sf11b2">: </span><span class="sf3b2">new_xyz</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">d</span><span class="sf11b2">&nbsp;= {</span><span class="sf12b2">"xyz"</span><span class="sf11b2">: </span><span class="sf3b2">new_xyz</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"f_dc"</span><span class="sf11b2">: </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"f_dc"</span><span class="sf11b2">: </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"f_rest"</span><span class="sf11b2">: </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"f_rest"</span><span class="sf11b2">: </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"features"</span><span class="sf11b2">: </span><span class="sf3b2">new_features</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"features"</span><span class="sf11b2">: </span><span class="sf3b2">new_features</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"opacity"</span><span class="sf11b2">: </span><span class="sf3b2">new_opacities</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"opacity"</span><span class="sf11b2">: </span><span class="sf3b2">new_opacities</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"scaling"</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">new_scaling</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"scaling"</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">new_scaling</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"rotation"</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">new_rotation</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"rotation"</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">new_rotation</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"depth_err"</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">}</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf12b2">"depth_err"</span><span class="sf11b2">&nbsp;: </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">cat_tensors_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">d</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">cat_tensors_to_optimizer</span><span class="sf11b2">(</span><span class="sf3b2">d</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"xyz"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"xyz"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_dc"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_dc"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_rest"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"f_rest"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"features"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"features"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"opacity"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"scaling"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"scaling"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"rotation"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"rotation"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"depth_err"</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">optimizable_tensors</span><span class="sf11b2">[</span><span class="sf12b2">"depth_err"</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">opa_gradient_accum</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom_2</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">], </span><span class="sf10b2">1</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densify_and_split</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf3b2">scene_extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">, </span><span class="sf3b2">N</span><span class="sf11b2">=</span><span class="sf10b2">2</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densify_and_split</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf3b2">scene_extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">, </span><span class="sf3b2">N</span><span class="sf11b2">=</span><span class="sf10b2">2</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">n_init_points</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">n_init_points</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># Extract points that satisfy the gradient condition</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># Extract points that satisfy the gradient condition</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">padded_grad</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">n_init_points</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">padded_grad</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">n_init_points</span><span class="sf11b2">), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">padded_grad</span><span class="sf11b2">[:</span><span class="sf3b2">grads</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]] = </span><span class="sf3b2">grads</span><span class="sf11b2">.</span><span class="sf8b2">squeeze</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">padded_grad</span><span class="sf11b2">[:</span><span class="sf3b2">grads</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">[</span><span class="sf10b2">0</span><span class="sf11b2">]] = </span><span class="sf3b2">grads</span><span class="sf11b2">.</span><span class="sf8b2">squeeze</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask_base</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">where</span><span class="sf11b2">(</span><span class="sf3b2">padded_grad</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf20b2">True</span><span class="sf11b2">, </span><span class="sf20b2">False</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask_base</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">where</span><span class="sf11b2">(</span><span class="sf3b2">padded_grad</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf20b2">True</span><span class="sf11b2">, </span><span class="sf20b2">False</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask_base</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask_bas<wbr>e</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask_base</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask_bas<wbr>e</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_scaling</span><span class="sf11b2">, </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">*</span><span class="sf3b2">scene_extent</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_scaling</span><span class="sf11b2">, </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">*</span><span class="sf3b2">scene_extent</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask_bas<wbr>e</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask_bas<wbr>e</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">.</span><span class="sf8b2">squeeze</span><span class="sf11b2">() &gt; </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">.</span><span class="sf8b2">squeeze</span><span class="sf11b2">() &gt; </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># selected_pts_mask = torch.logical_or(selected_pts_mask,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># selected_pts_mask = torch.logical_or(selected_pts_mask,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; selected_pts_mask_base * (self.get_scaling.max(dim=1).values / self.get_scaling.min(dim=1).values &gt; 10))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; selected_pts_mask_base * (self.get_scaling.max(dim=1).values / self.get_scaling.min(dim=1).values &gt; 10))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stds</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_scaling</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">rep<wbr>eat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">stds</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_scaling</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">rep<wbr>eat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">means</span><span class="sf11b2">&nbsp;=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">stds</span><span class="sf11b2">.</span><span class="sf8b2">size</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">), </span><span class="sf10b2">3</span><span class="sf11b2">),</span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">means</span><span class="sf11b2">&nbsp;=</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">((</span><span class="sf3b2">stds</span><span class="sf11b2">.</span><span class="sf8b2">size</span><span class="sf11b2">(</span><span class="sf10b2">0</span><span class="sf11b2">), </span><span class="sf10b2">3</span><span class="sf11b2">),</span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">samples</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">normal</span><span class="sf11b2">(</span><span class="sf3b2">mean</span><span class="sf11b2">=</span><span class="sf3b2">means</span><span class="sf11b2">, </span><span class="sf3b2">std</span><span class="sf11b2">=</span><span class="sf3b2">stds</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">samples</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">normal</span><span class="sf11b2">(</span><span class="sf3b2">mean</span><span class="sf11b2">=</span><span class="sf3b2">means</span><span class="sf11b2">, </span><span class="sf3b2">std</span><span class="sf11b2">=</span><span class="sf3b2">stds</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># samples = torch.clamp(samples, max=torch.ones_like(samples) * scene_extent * 0.1, min=-torch.ones_like(samples) * scene_extent * 0.1)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># samples = torch.clamp(samples, max=torch.ones_like(samples) * scene_extent * 0.1, min=-torch.ones_like(samples) * scene_extent * 0.1)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">build_rotation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">selected_<wbr>pts_mask</span><span class="sf11b2">]).</span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">rots</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">build_rotation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">selected_<wbr>pts_mask</span><span class="sf11b2">]).</span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">bmm</span><span class="sf11b2">(</span><span class="sf3b2">rots</span><span class="sf11b2">, </span><span class="sf3b2">samples</span><span class="sf11b2">.</span><span class="sf8b2">unsqueeze</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">)).</span><span class="sf8b2">squeeze</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">) + </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repeat</span><span class="sf11b2">(<wbr></span><span class="sf3b2">N</span><span class="sf11b2">, </span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">bmm</span><span class="sf11b2">(</span><span class="sf3b2">rots</span><span class="sf11b2">, </span><span class="sf3b2">samples</span><span class="sf11b2">.</span><span class="sf8b2">unsqueeze</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">)).</span><span class="sf8b2">squeeze</span><span class="sf11b2">(-</span><span class="sf10b2">1</span><span class="sf11b2">) + </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_xyz</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repeat</span><span class="sf11b2">(<wbr></span><span class="sf3b2">N</span><span class="sf11b2">, </span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">scaling_inverse_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">ge<wbr>t_scaling</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1<wbr></span><span class="sf11b2">) / (</span><span class="sf10b2">0.8</span><span class="sf11b2">*</span><span class="sf3b2">N</span><span class="sf11b2">))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">scaling_inverse_activation</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">ge<wbr>t_scaling</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1<wbr></span><span class="sf11b2">) / (</span><span class="sf10b2">0.8</span><span class="sf11b2">*</span><span class="sf3b2">N</span><span class="sf11b2">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repea<wbr>t</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repea<wbr>t</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">re<wbr>peat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">re<wbr>peat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].<wbr></span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].<wbr></span><span class="sf8b2">repeat</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repea<wbr>t</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repea<wbr>t</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repeat<wbr></span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_opacity</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repeat<wbr></span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repe<wbr>at</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">].</span><span class="sf8b2">repe<wbr>at</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">,</span><span class="sf10b2">1</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densification_postfix</span><span class="sf11b2">(</span><span class="sf3b2">new_xyz</span><span class="sf11b2">, </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">, </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">, </span><span class="sf3b2">new_features</span><span class="sf11b2">, </span><span class="sf3b2">new_opacity</span><span class="sf11b2">, </span><span class="sf3b2">new_scaling</span><span class="sf11b2">, </span><span class="sf3b2">new_rotation</span><span class="sf11b2">, </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densification_postfix</span><span class="sf11b2">(</span><span class="sf3b2">new_xyz</span><span class="sf11b2">, </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">, </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">, </span><span class="sf3b2">new_features</span><span class="sf11b2">, </span><span class="sf3b2">new_opacity</span><span class="sf11b2">, </span><span class="sf3b2">new_scaling</span><span class="sf11b2">, </span><span class="sf3b2">new_rotation</span><span class="sf11b2">, </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_filter</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">, </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">&nbsp;* </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">.</span><span class="sf21b2">sum</span><span class="sf11b2">(), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf21b2">bool</span><span class="sf11b2">)))</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_filter</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">cat</span><span class="sf11b2">((</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">, </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">zeros</span><span class="sf11b2">(</span><span class="sf3b2">N</span><span class="sf11b2">&nbsp;* </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">.</span><span class="sf21b2">sum</span><span class="sf11b2">(), </span><span class="sf3b2">device</span><span class="sf11b2">=</span><span class="sf12b2">"cuda"</span><span class="sf11b2">, </span><span class="sf3b2">dtype</span><span class="sf11b2">=</span><span class="sf21b2">bool</span><span class="sf11b2">)))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">prune_filter</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">prune_filter</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densify_and_clone</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf3b2">scene_extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densify_and_clone</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf3b2">scene_extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># Extract points that satisfy the gradient condition</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># Extract points that satisfy the gradient condition</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">where</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">norm</span><span class="sf11b2">(</span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">dim</span><span class="sf11b2">=-</span><span class="sf10b2">1</span><span class="sf11b2">) &gt;= </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf20b2">True</span><span class="sf11b2">, </span><span class="sf20b2">False</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">where</span><span class="sf11b2">(</span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">norm</span><span class="sf11b2">(</span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">dim</span><span class="sf11b2">=-</span><span class="sf10b2">1</span><span class="sf11b2">) &gt;= </span><span class="sf3b2">grad_threshold</span><span class="sf11b2">, </span><span class="sf20b2">True</span><span class="sf11b2">, </span><span class="sf20b2">False</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_scaling</span><span class="sf11b2">, </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">&nbsp;&lt;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">*</span><span class="sf3b2">scene_extent</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf21b2">max</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_scaling</span><span class="sf11b2">, </span><span class="sf3b2">dim</span><span class="sf11b2">=</span><span class="sf10b2">1</span><span class="sf11b2">).</span><span class="sf3b2">values</span><span class="sf11b2">&nbsp;&lt;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">percent_dense</span><span class="sf11b2">*</span><span class="sf3b2">scene_extent</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">,</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">logical_and</span><span class="sf11b2">(</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">.</span><span class="sf8b2">squeeze</span><span class="sf11b2">() &gt; </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">.</span><span class="sf8b2">squeeze</span><span class="sf11b2">() &gt; </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_xyz</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_dc</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features_rest</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_features</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_features</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_opacities</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_opacity</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_depth_err</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_scaling</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_scaling</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">new_rotation</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_rotation</span><span class="sf11b2">[</span><span class="sf3b2">selected_pts_mask</span><span class="sf11b2">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densification_postfix</span><span class="sf11b2">(</span><span class="sf3b2">new_xyz</span><span class="sf11b2">, </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">, </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">, </span><span class="sf3b2">new_features</span><span class="sf11b2">, </span><span class="sf3b2">new_opacities</span><span class="sf11b2">, </span><span class="sf3b2">new_scaling</span><span class="sf11b2">, </span><span class="sf3b2">new_rotation</span><span class="sf11b2">, </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densification_postfix</span><span class="sf11b2">(</span><span class="sf3b2">new_xyz</span><span class="sf11b2">, </span><span class="sf3b2">new_features_dc</span><span class="sf11b2">, </span><span class="sf3b2">new_features_rest</span><span class="sf11b2">, </span><span class="sf3b2">new_features</span><span class="sf11b2">, </span><span class="sf3b2">new_opacities</span><span class="sf11b2">, </span><span class="sf3b2">new_scaling</span><span class="sf11b2">, </span><span class="sf3b2">new_rotation</span><span class="sf11b2">, </span><span class="sf3b2">new_depth_err</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densify_and_prune</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">max_grad</span><span class="sf11b2">, </span><span class="sf3b2">min_opacity</span><span class="sf11b2">, </span><span class="sf3b2">extent</span><span class="sf11b2">, </span><span class="sf3b2">max_screen_size</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">, </span><span class="sf3b2">max_dist</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">densify_and_prune</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">max_grad</span><span class="sf11b2">, </span><span class="sf3b2">min_opacity</span><span class="sf11b2">, </span><span class="sf3b2">extent</span><span class="sf11b2">, </span><span class="sf3b2">max_screen_size</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">, </span><span class="sf3b2">max_dist</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">max_dist</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">max_dist</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">is</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">not</span><span class="sf11b2">&nbsp;</span><span class="sf20b2">None</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">outliers_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">sqrt</span><span class="sf11b2">(</span><span class="sf8b2">distCUDA2</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">()<wbr>).</span><span class="sf8b2">view</span><span class="sf11b2">(</span><span class="sf3b2">max_dist</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)) &gt; </span><span class="sf3b2">max_dist</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">outliers_mask</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">sqrt</span><span class="sf11b2">(</span><span class="sf8b2">distCUDA2</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf8b2">detach</span><span class="sf11b2">()<wbr>).</span><span class="sf8b2">view</span><span class="sf11b2">(</span><span class="sf3b2">max_dist</span><span class="sf11b2">.</span><span class="sf3b2">shape</span><span class="sf11b2">)) &gt; </span><span class="sf3b2">max_dist</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">outliers_mask</span><span class="sf11b2">.</span><span class="sf8b2">squeeze<wbr></span><span class="sf11b2">())</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">outliers_mask</span><span class="sf11b2">.</span><span class="sf8b2">squeeze<wbr></span><span class="sf11b2">())</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">grads</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;/ </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">grads</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">&nbsp;/ </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">grads</span><span class="sf11b2">[</span><span class="sf3b2">grads</span><span class="sf11b2">.</span><span class="sf8b2">isnan</span><span class="sf11b2">()] = </span><span class="sf10b2">0.0</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">grads</span><span class="sf11b2">[</span><span class="sf3b2">grads</span><span class="sf11b2">.</span><span class="sf8b2">isnan</span><span class="sf11b2">()] = </span><span class="sf10b2">0.0</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densify_and_clone</span><span class="sf11b2">(</span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">max_grad</span><span class="sf11b2">, </span><span class="sf3b2">extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densify_and_clone</span><span class="sf11b2">(</span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">max_grad</span><span class="sf11b2">, </span><span class="sf3b2">extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densify_and_split</span><span class="sf11b2">(</span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">max_grad</span><span class="sf11b2">, </span><span class="sf3b2">extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">densify_and_split</span><span class="sf11b2">(</span><span class="sf3b2">grads</span><span class="sf11b2">, </span><span class="sf3b2">max_grad</span><span class="sf11b2">, </span><span class="sf3b2">extent</span><span class="sf11b2">, </span><span class="sf3b2">opa_thresh</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_mask</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">&nbsp;&lt; </span><span class="sf3b2">min_opacity</span><span class="sf11b2">).</span><span class="sf8b2">squeeze</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_mask</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">&nbsp;&lt; </span><span class="sf3b2">min_opacity</span><span class="sf11b2">).</span><span class="sf8b2">squeeze</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">max_screen_size</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">max_screen_size</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">big_points_vs</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf3b2">max_screen_size</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">big_points_vs</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">max_radii2D</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf3b2">max_screen_size</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_mask</span><span class="sf11b2">&nbsp;+= </span><span class="sf3b2">big_points_vs</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_mask</span><span class="sf11b2">&nbsp;+= </span><span class="sf3b2">big_points_vs</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">prune_mask</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">prune_mask</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">cuda</span><span class="sf11b2">.</span><span class="sf8b2">empty_cache</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">cuda</span><span class="sf11b2">.</span><span class="sf8b2">empty_cache</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"><a id="d4" href="#d4">.</a></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">def</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">add_points</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">colors</span><span style="color: #000000; background-color: #efcb05; ">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_xyz</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_xyz</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">numel</span><span style="color: #000000; background-color: #efcb05; ">() &gt; </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">"cuda"</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">to</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">colors</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">colors</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">to</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">ndim</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;!= </span><span style="color: #000000; background-color: #efcb05; ">2</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">or</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">shape</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">] != </span><span style="color: #000000; background-color: #efcb05; ">3</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">raise</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">ValueError</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">"points must have shape [N, 3]"</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">colors</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">ndim</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;!= </span><span style="color: #000000; background-color: #efcb05; ">2</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">or</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">colors</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">shape</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">] != </span><span style="color: #000000; background-color: #efcb05; ">3</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">raise</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">ValueError</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">"colors must have shape [N, 3]"</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">shape</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">sh_dim</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= (</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">max_sh_degree</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;+ </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">) ** </span><span style="color: #000000; background-color: #efcb05; ">2</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">features_dc</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">RGB2SH</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">colors</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">view</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">3</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">features_rest</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">sh_dim</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;- </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">3</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">numel</span><span style="color: #000000; background-color: #efcb05; ">() &gt; </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">feat_dim</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">shape</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">features</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">feat_dim</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">features</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">32</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_scaling</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">numel</span><span style="color: #000000; background-color: #efcb05; ">() &gt; </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">avg_scaling</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">get_scaling</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">mean</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">avg_scaling</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">ones</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">3</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">scaling</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">scaling_inverse_activation</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">avg_sca<wbr>ling</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">view</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">3</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">repeat</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">rotation</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">4</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">rotation</span><span style="color: #000000; background-color: #efcb05; ">[:, </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">] = </span><span style="color: #000000; background-color: #efcb05; ">1.0</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">opa_val</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">full</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">0.1</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">opacity</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">inverse_opacity_activation</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">opa_val<wbr></span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">depth_err</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">tensors_dict</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= {</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"xyz"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"f_dc"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">features_dc</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"f_rest"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">features_rest</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"features"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">features</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"opacity"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">opacity</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"depth_err"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">depth_err</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"scaling"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">scaling</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">"rotation"</span><span style="color: #000000; background-color: #efcb05; ">: </span><span style="color: #000000; background-color: #efcb05; ">rotation</span><span style="color: #000000; background-color: #efcb05; ">,</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">optimizer</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">is</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">not</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">None</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat_tensors_to_optimizer</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">tensors_d<wbr>ict</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_xyz</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"xyz"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features_dc</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"f_dc"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features_rest</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"f_rest"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"features"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_opacity</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"opacity"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_depth_err</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"depth_err"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_scaling</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"scaling"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_rotation</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">optimizable_tensors</span><span style="color: #000000; background-color: #efcb05; ">[</span><span style="color: #000000; background-color: #efcb05; ">"rotation"</span><span style="color: #000000; background-color: #efcb05; ">]</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_xyz</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_xyz</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">points</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features_dc</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features_<wbr>dc</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">features_dc</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features_rest</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features_<wbr>rest</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">features_rest</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_features</span><span style="color: #000000; background-color: #efcb05; ">,<wbr> </span><span style="color: #000000; background-color: #efcb05; ">features</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_opacity</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_opacity</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">opacity</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_depth_err</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_depth_err<wbr></span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">depth_err</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_scaling</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_scaling</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">scaling</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_rotation</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">nn</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">Parameter</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">_rotation</span><span style="color: #000000; background-color: #efcb05; ">,<wbr> </span><span style="color: #000000; background-color: #efcb05; ">rotation</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">).</span><span style="color: #000000; background-color: #efcb05; ">requires_grad_</span><span style="color: #000000; background-color: #efcb05; ">(</span><span style="color: #000000; background-color: #efcb05; ">True</span><span style="color: #000000; background-color: #efcb05; ">))</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">1</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">if</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">xyz_gradient_accum</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">numel</span><span style="color: #000000; background-color: #efcb05; ">() == </span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">xyz_gradient_accum</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">clone</span><span style="color: #000000; background-color: #efcb05; ">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">opa_gradient_accum</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">clone</span><span style="color: #000000; background-color: #efcb05; ">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">denom</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">clone</span><span style="color: #000000; background-color: #efcb05; ">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">denom_2</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">clone</span><span style="color: #000000; background-color: #efcb05; ">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">max_radii2D</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">,), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; font-weight: bold; ">else</span><span style="color: #000000; background-color: #efcb05; ">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">xyz_gradient_accum</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">xyz_gradient_accum</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">opa_gradient_accum</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">opa_gradient_accum</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">denom</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">denom</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">denom_2</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">denom_2</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">zeros_accum</span><span style="color: #000000; background-color: #efcb05; ">), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">max_radii2D</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">cat</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">self</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">max_radii2D</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">zeros</span><span style="color: #000000; background-color: #efcb05; ">((</span><span style="color: #000000; background-color: #efcb05; ">n_new</span><span style="color: #000000; background-color: #efcb05; ">,), </span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">device</span><span style="color: #000000; background-color: #efcb05; ">, </span><span style="color: #000000; background-color: #efcb05; ">dtype</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">torch</span><span style="color: #000000; background-color: #efcb05; ">.</span><span style="color: #000000; background-color: #efcb05; ">float32</span><span style="color: #000000; background-color: #efcb05; ">)), </span><span style="color: #000000; background-color: #efcb05; ">dim</span><span style="color: #000000; background-color: #efcb05; ">=</span><span style="color: #000000; background-color: #efcb05; ">0</span><span style="color: #000000; background-color: #efcb05; ">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">add_densification_stats</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">viewspace_point_tensor</span><span class="sf11b2">, </span><span class="sf3b2">update_filter</span><span class="sf11b2">, </span><span class="sf3b2">accum_denom</span><span class="sf11b2">=</span><span class="sf20b2">True</span><span class="sf11b2">, </span><span class="sf3b2">add_random</span><span class="sf11b2">=</span><span class="sf20b2">False</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">add_densification_stats</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">viewspace_point_tensor</span><span class="sf11b2">, </span><span class="sf3b2">update_filter</span><span class="sf11b2">, </span><span class="sf3b2">accum_denom</span><span class="sf11b2">=</span><span class="sf20b2">True</span><span class="sf11b2">, </span><span class="sf3b2">add_random</span><span class="sf11b2">=</span><span class="sf20b2">False</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># increase randomness to overcome local minima</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2"># increase randomness to overcome local minima</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">add_random</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">add_random</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">update_filter</span><span class="sf11b2">] += </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">norm</span><span class="sf11b2">((</span><span class="sf3b2">viewspace_point_tensor</span><span class="sf11b2">.</span><span class="sf3b2">grad<wbr></span><span class="sf11b2">&nbsp;- </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf3b2">grad</span><span class="sf11b2">)[</span><span class="sf3b2">update_filter</span><span class="sf11b2">,:</span><span class="sf10b2">2</span><span class="sf11b2">], </span><span class="sf3b2">dim</span><span class="sf11b2">=-</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf3b2">keepdim</span><span class="sf11b2">=</span><span class="sf20b2">True</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">update_filter</span><span class="sf11b2">] += </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">norm</span><span class="sf11b2">((</span><span class="sf3b2">viewspace_point_tensor</span><span class="sf11b2">.</span><span class="sf3b2">grad<wbr></span><span class="sf11b2">&nbsp;- </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">_xyz</span><span class="sf11b2">.</span><span class="sf3b2">grad</span><span class="sf11b2">)[</span><span class="sf3b2">update_filter</span><span class="sf11b2">,:</span><span class="sf10b2">2</span><span class="sf11b2">], </span><span class="sf3b2">dim</span><span class="sf11b2">=-</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf3b2">keepdim</span><span class="sf11b2">=</span><span class="sf20b2">True</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">else</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">else</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">update_filter</span><span class="sf11b2">] += </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">norm</span><span class="sf11b2">((</span><span class="sf3b2">viewspace_point_tensor</span><span class="sf11b2">.</span><span class="sf3b2">grad<wbr></span><span class="sf11b2">)[</span><span class="sf3b2">update_filter</span><span class="sf11b2">,:</span><span class="sf10b2">2</span><span class="sf11b2">], </span><span class="sf3b2">dim</span><span class="sf11b2">=-</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf3b2">keepdim</span><span class="sf11b2">=</span><span class="sf20b2">True</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">xyz_gradient_accum</span><span class="sf11b2">[</span><span class="sf3b2">update_filter</span><span class="sf11b2">] += </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf8b2">norm</span><span class="sf11b2">((</span><span class="sf3b2">viewspace_point_tensor</span><span class="sf11b2">.</span><span class="sf3b2">grad<wbr></span><span class="sf11b2">)[</span><span class="sf3b2">update_filter</span><span class="sf11b2">,:</span><span class="sf10b2">2</span><span class="sf11b2">], </span><span class="sf3b2">dim</span><span class="sf11b2">=-</span><span class="sf10b2">1</span><span class="sf11b2">, </span><span class="sf3b2">keepdim</span><span class="sf11b2">=</span><span class="sf20b2">True</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">accum_denom</span><span class="sf11b2">:</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">accum_denom</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">[</span><span class="sf3b2">update_filter</span><span class="sf11b2">] += </span><span class="sf10b2">1</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">denom</span><span class="sf11b2">[</span><span class="sf3b2">update_filter</span><span class="sf11b2">] += </span><span class="sf10b2">1</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">prune</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">min_opacity</span><span class="sf11b2">, </span><span class="sf3b2">max_err</span><span class="sf11b2">=</span><span class="sf20b2">None</span><span class="sf11b2">):</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">def</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">prune</span><span class="sf11b2">(</span><span class="sf3b2">self</span><span class="sf11b2">, </span><span class="sf3b2">min_opacity</span><span class="sf11b2">, </span><span class="sf3b2">max_err</span><span class="sf11b2">=</span><span class="sf20b2">None</span><span class="sf11b2">):</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_mask</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">&nbsp;&lt; </span><span class="sf3b2">min_opacity</span><span class="sf11b2">).</span><span class="sf8b2">squeeze</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">prune_mask</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf3b2">get_opacity</span><span class="sf11b2">&nbsp;&lt; </span><span class="sf3b2">min_opacity</span><span class="sf11b2">).</span><span class="sf8b2">squeeze</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">prune_mask</span><span class="sf11b2">)</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">self</span><span class="sf11b2">.</span><span class="sf8b2">prune_points</span><span class="sf11b2">(</span><span class="sf3b2">prune_mask</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">cuda</span><span class="sf11b2">.</span><span class="sf8b2">empty_cache</span><span class="sf11b2">()</span></code></td>
<td class="ln"></td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">torch</span><span class="sf11b2">.</span><span class="sf3b2">cuda</span><span class="sf11b2">.</span><span class="sf8b2">empty_cache</span><span class="sf11b2">()</span></code></td>
</tr>
<tr>
<td class="ln"><a id="d5" href="#d5">.</a></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td style="color: #000000; background-color: #efcb05; "><code>&nbsp;</code></td>
<td class="ln"></td><td style="color: #000000; background-color: #c0c0c0; "><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln"></td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
</tbody>
</table>
</body>
</html>
